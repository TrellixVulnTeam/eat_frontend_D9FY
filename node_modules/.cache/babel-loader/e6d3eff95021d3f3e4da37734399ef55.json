{"remainingRequest":"C:\\Users\\shani.VOICESENSE\\Documents\\CodingAcademy\\Ex-Submissions\\Shani Herzinger\\eat-with\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\shani.VOICESENSE\\Documents\\CodingAcademy\\Ex-Submissions\\Shani Herzinger\\eat-with\\frontend\\src\\services\\NEW-user-service.js","dependencies":[{"path":"C:\\Users\\shani.VOICESENSE\\Documents\\CodingAcademy\\Ex-Submissions\\Shani Herzinger\\eat-with\\frontend\\src\\services\\NEW-user-service.js","mtime":1627235850717},{"path":"C:\\Users\\shani.VOICESENSE\\Documents\\CodingAcademy\\Ex-Submissions\\Shani Herzinger\\eat-with\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1626260724928},{"path":"C:\\Users\\shani.VOICESENSE\\Documents\\CodingAcademy\\Ex-Submissions\\Shani Herzinger\\eat-with\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1626260715884}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gaW1wb3J0IHsgc3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuL2FzeW5jLXN0b3JhZ2Uuc2VydmljZScKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICcuL2h0dHAuc2VydmljZSc7CmltcG9ydCB7IHNvY2tldFNlcnZpY2UsIFNPQ0tFVF9FVkVOVF9VU0VSX1VQREFURUQgfSBmcm9tICcuL3NvY2tldC5zZXJ2aWNlJzsKY29uc3QgU1RPUkFHRV9LRVlfTE9HR0VESU5fVVNFUiA9ICdsb2dnZWRpblVzZXInOyAvLyBjb25zdCBTQ09SRV9GT1JfUkVWSUVXID0gMTAKLy8gdmFyIGdXYXRjaGVkVXNlciA9IG51bGw7CgpleHBvcnQgY29uc3QgTkVXdXNlclNlcnZpY2UgPSB7CiAgbG9naW4sCiAgbG9nb3V0LAogIHNpZ251cCwKICBnZXRVc2VycywKICBnZXRCeUlkLAogIHJlbW92ZSwKICB1cGRhdGUsCiAgZ2V0TG9nZ2VkaW5Vc2VyCn07IC8vIHdpbmRvdy51c2VyU2VydmljZSA9IHVzZXJTZXJ2aWNlCi8vIE5vdGU6IGR1ZSB0byBhc3luYywgbXVzdCBydW4gb25lIGJ5IG9uZS4uLgovLyB1c2VyU2VydmljZS5zaWdudXAoe2Z1bGxuYW1lOiAnUHVraSBOb3JtYScsIHVzZXJuYW1lOiAndXNlcjEnLCBwYXNzd29yZDonMTIzJyxzY29yZTogMTAwLCBpc0FkbWluOiBmYWxzZX0pCi8vIHVzZXJTZXJ2aWNlLnNpZ251cCh7ZnVsbG5hbWU6ICdNYXN0ZXIgQWRtaW5vdicsIHVzZXJuYW1lOiAnYWRtaW4nLCBwYXNzd29yZDonMTIzJywgc2NvcmU6IDEwMCwgaXNBZG1pbjogdHJ1ZX0pCi8vIHVzZXJTZXJ2aWNlLnNpZ251cCh7ZnVsbG5hbWU6ICdNdWtpIEcnLCB1c2VybmFtZTogJ211a2knLCBwYXNzd29yZDonMTIzJywgc2NvcmU6IDEwMH0pCgpmdW5jdGlvbiBnZXRVc2VycygpIHsKICByZXR1cm4gaHR0cFNlcnZpY2UuZ2V0KGB1c2VyYCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIHNpZ251cCh1c2VyQ3JlZCkgewogIGNvbnN0IHVzZXIgPSBhd2FpdCBodHRwU2VydmljZS5wb3N0KCdhdXRoL3NpZ251cCcsIHVzZXJDcmVkKTsKICBzb2NrZXRTZXJ2aWNlLmVtaXQoJ3NldC11c2VyLXNvY2tldCcsIHVzZXIuX2lkKTsKICByZXR1cm4gX3NhdmVMb2NhbFVzZXIodXNlcik7Cn0KCmFzeW5jIGZ1bmN0aW9uIGxvZ2luKHVzZXJDcmVkKSB7CiAgY29uc3QgdXNlciA9IGF3YWl0IGh0dHBTZXJ2aWNlLnBvc3QoJ2F1dGgvbG9naW4nLCB1c2VyQ3JlZCk7CiAgc29ja2V0U2VydmljZS5lbWl0KCdsb2dpbicsIHVzZXIuX2lkKTsKICBpZiAodXNlcikgcmV0dXJuIF9zYXZlTG9jYWxVc2VyKHVzZXIpOwp9Cgphc3luYyBmdW5jdGlvbiBnZXRCeUlkKHVzZXJJZCkgewogIGNvbnN0IHVzZXIgPSBhd2FpdCBodHRwU2VydmljZS5nZXQoYHVzZXIvJHt1c2VySWR9YCk7CiAgcmV0dXJuIHVzZXI7Cn0KCmZ1bmN0aW9uIHJlbW92ZSh1c2VySWQpIHsKICByZXR1cm4gaHR0cFNlcnZpY2UuZGVsZXRlKGB1c2VyLyR7dXNlcklkfWApOwp9Cgphc3luYyBmdW5jdGlvbiB1cGRhdGUodXNlcikgewogIHVzZXIgPSBhd2FpdCBodHRwU2VydmljZS5wdXQoYHVzZXIvJHt1c2VyLl9pZH1gLCB1c2VyKTsKICBpZiAoZ2V0TG9nZ2VkaW5Vc2VyKCkuX2lkID09PSB1c2VyLl9pZCkgX3NhdmVMb2NhbFVzZXIodXNlcik7CiAgcmV0dXJuIHVzZXI7Cn0KCmFzeW5jIGZ1bmN0aW9uIGxvZ291dCgpIHsKICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKFNUT1JBR0VfS0VZX0xPR0dFRElOX1VTRVIpOwogIHNvY2tldFNlcnZpY2UuZW1pdCgndW5zZXQtdXNlci1zb2NrZXQnKTsKICByZXR1cm4gYXdhaXQgaHR0cFNlcnZpY2UucG9zdCgnYXV0aC9sb2dvdXQnKTsKfQoKZnVuY3Rpb24gX3NhdmVMb2NhbFVzZXIodXNlcikgewogIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVlfTE9HR0VESU5fVVNFUiwgSlNPTi5zdHJpbmdpZnkodXNlcikpOwogIHJldHVybiB1c2VyOwp9CgpmdW5jdGlvbiBnZXRMb2dnZWRpblVzZXIoKSB7CiAgcmV0dXJuIEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWV9MT0dHRURJTl9VU0VSKSB8fCAnbnVsbCcpOwp9CgooYXN5bmMgKCkgPT4gewogIHZhciB1c2VyID0gZ2V0TG9nZ2VkaW5Vc2VyKCk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWdXYXRjaGVkVXNlcikgcmV0dXJuOwogICAgY29uc3QgZnJlc2hVc2VycyA9IGF3YWl0IHN0b3JhZ2VTZXJ2aWNlLnF1ZXJ5KCd1c2VyJyk7CiAgICBjb25zdCB3YXRjaGVkVXNlciA9IGZyZXNoVXNlcnMuZmluZCh1ID0+IHUuX2lkID09PSBnV2F0Y2hlZFVzZXIuX2lkKTsKICAgIGlmICghd2F0Y2hlZFVzZXIpIHJldHVybjsKCiAgICBpZiAoZ1dhdGNoZWRVc2VyLnNjb3JlICE9PSB3YXRjaGVkVXNlci5zY29yZSkgewogICAgICBjb25zb2xlLmxvZygnV2F0Y2hlZCB1c2VyIHNjb3JlIGNoYW5nZWQgLSBsb2NhbFN0b3JhZ2UgdXBkYXRlZCBmcm9tIGFub3RoZXIgYnJvd3NlcicpOwogICAgICBzb2NrZXRTZXJ2aWNlLmVtaXQoU09DS0VUX0VWRU5UX1VTRVJfVVBEQVRFRCwgd2F0Y2hlZFVzZXIpOwogICAgfQoKICAgIGdXYXRjaGVkVXNlciA9IHdhdGNoZWRVc2VyOwogIH0pOwp9KSgpOyAvL3NvY2tldFNlcnZpY2U6CgoKKGFzeW5jICgpID0+IHsKICB2YXIgdXNlciA9IGdldExvZ2dlZGluVXNlcigpOwogIGlmICh1c2VyKSBzb2NrZXRTZXJ2aWNlLmVtaXQoJ3NldC11c2VyLXNvY2tldCcsIHVzZXIuX2lkKTsKfSkoKTs="},{"version":3,"sources":["C:/Users/shani.VOICESENSE/Documents/CodingAcademy/Ex-Submissions/Shani Herzinger/eat-with/frontend/src/services/NEW-user-service.js"],"names":["httpService","socketService","SOCKET_EVENT_USER_UPDATED","STORAGE_KEY_LOGGEDIN_USER","NEWuserService","login","logout","signup","getUsers","getById","remove","update","getLoggedinUser","get","userCred","user","post","emit","_id","_saveLocalUser","userId","delete","put","sessionStorage","removeItem","setItem","JSON","stringify","parse","getItem","window","addEventListener","gWatchedUser","freshUsers","storageService","query","watchedUser","find","u","score","console","log"],"mappings":"AAAA;AACA,SAASA,WAAT,QAA4B,gBAA5B;AACA,SAASC,aAAT,EAAwBC,yBAAxB,QAAyD,kBAAzD;AACA,MAAMC,yBAAyB,GAAG,cAAlC,C,CACA;AACA;;AAEA,OAAO,MAAMC,cAAc,GAAG;AAC1BC,EAAAA,KAD0B;AAE1BC,EAAAA,MAF0B;AAG1BC,EAAAA,MAH0B;AAI1BC,EAAAA,QAJ0B;AAK1BC,EAAAA,OAL0B;AAM1BC,EAAAA,MAN0B;AAO1BC,EAAAA,MAP0B;AAQ1BC,EAAAA;AAR0B,CAAvB,C,CAWP;AAEA;AACA;AACA;AACA;;AAEA,SAASJ,QAAT,GAAoB;AAChB,SAAOR,WAAW,CAACa,GAAZ,CAAiB,MAAjB,CAAP;AACH;;AAED,eAAeN,MAAf,CAAsBO,QAAtB,EAAgC;AAC5B,QAAMC,IAAI,GAAG,MAAMf,WAAW,CAACgB,IAAZ,CAAiB,aAAjB,EAAgCF,QAAhC,CAAnB;AACAb,EAAAA,aAAa,CAACgB,IAAd,CAAmB,iBAAnB,EAAsCF,IAAI,CAACG,GAA3C;AACA,SAAOC,cAAc,CAACJ,IAAD,CAArB;AACH;;AAED,eAAeV,KAAf,CAAqBS,QAArB,EAA+B;AAC3B,QAAMC,IAAI,GAAG,MAAMf,WAAW,CAACgB,IAAZ,CAAiB,YAAjB,EAA+BF,QAA/B,CAAnB;AACAb,EAAAA,aAAa,CAACgB,IAAd,CAAmB,OAAnB,EAA4BF,IAAI,CAACG,GAAjC;AACA,MAAIH,IAAJ,EAAU,OAAOI,cAAc,CAACJ,IAAD,CAArB;AACb;;AAED,eAAeN,OAAf,CAAuBW,MAAvB,EAA+B;AAC3B,QAAML,IAAI,GAAG,MAAMf,WAAW,CAACa,GAAZ,CAAiB,QAAOO,MAAO,EAA/B,CAAnB;AACA,SAAOL,IAAP;AACH;;AACD,SAASL,MAAT,CAAgBU,MAAhB,EAAwB;AACpB,SAAOpB,WAAW,CAACqB,MAAZ,CAAoB,QAAOD,MAAO,EAAlC,CAAP;AACH;;AAED,eAAeT,MAAf,CAAsBI,IAAtB,EAA4B;AACxBA,EAAAA,IAAI,GAAG,MAAMf,WAAW,CAACsB,GAAZ,CAAiB,QAAOP,IAAI,CAACG,GAAI,EAAjC,EAAoCH,IAApC,CAAb;AACA,MAAIH,eAAe,GAAGM,GAAlB,KAA0BH,IAAI,CAACG,GAAnC,EAAwCC,cAAc,CAACJ,IAAD,CAAd;AACxC,SAAOA,IAAP;AACH;;AAED,eAAeT,MAAf,GAAwB;AACpBiB,EAAAA,cAAc,CAACC,UAAf,CAA0BrB,yBAA1B;AACAF,EAAAA,aAAa,CAACgB,IAAd,CAAmB,mBAAnB;AACA,SAAO,MAAMjB,WAAW,CAACgB,IAAZ,CAAiB,aAAjB,CAAb;AACH;;AAED,SAASG,cAAT,CAAwBJ,IAAxB,EAA8B;AAC1BQ,EAAAA,cAAc,CAACE,OAAf,CAAuBtB,yBAAvB,EAAkDuB,IAAI,CAACC,SAAL,CAAeZ,IAAf,CAAlD;AACA,SAAOA,IAAP;AACH;;AAED,SAASH,eAAT,GAA2B;AACvB,SAAOc,IAAI,CAACE,KAAL,CAAWL,cAAc,CAACM,OAAf,CAAuB1B,yBAAvB,KAAqD,MAAhE,CAAP;AACH;;AAED,CAAC,YAAY;AACT,MAAIY,IAAI,GAAGH,eAAe,EAA1B;AAEAkB,EAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,YAAY;AAC3C,QAAI,CAACC,YAAL,EAAmB;AACnB,UAAMC,UAAU,GAAG,MAAMC,cAAc,CAACC,KAAf,CAAqB,MAArB,CAAzB;AACA,UAAMC,WAAW,GAAGH,UAAU,CAACI,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACpB,GAAF,KAAUc,YAAY,CAACd,GAA5C,CAApB;AACA,QAAI,CAACkB,WAAL,EAAkB;;AAClB,QAAIJ,YAAY,CAACO,KAAb,KAAuBH,WAAW,CAACG,KAAvC,EAA8C;AAC1CC,MAAAA,OAAO,CAACC,GAAR,CAAY,wEAAZ;AACAxC,MAAAA,aAAa,CAACgB,IAAd,CAAmBf,yBAAnB,EAA8CkC,WAA9C;AACH;;AACDJ,IAAAA,YAAY,GAAGI,WAAf;AACH,GAVD;AAWH,CAdD,I,CAiBA;;;AAEA,CAAC,YAAY;AACT,MAAIrB,IAAI,GAAGH,eAAe,EAA1B;AACA,MAAIG,IAAJ,EAAUd,aAAa,CAACgB,IAAd,CAAmB,iBAAnB,EAAsCF,IAAI,CAACG,GAA3C;AACb,CAHD","sourcesContent":["// import { storageService } from './async-storage.service'\r\nimport { httpService } from './http.service'\r\nimport { socketService, SOCKET_EVENT_USER_UPDATED } from './socket.service'\r\nconst STORAGE_KEY_LOGGEDIN_USER = 'loggedinUser'\r\n// const SCORE_FOR_REVIEW = 10\r\n// var gWatchedUser = null;\r\n\r\nexport const NEWuserService = {\r\n    login,\r\n    logout,\r\n    signup,\r\n    getUsers,\r\n    getById,\r\n    remove,\r\n    update,\r\n    getLoggedinUser\r\n}\r\n\r\n// window.userService = userService\r\n\r\n// Note: due to async, must run one by one...\r\n// userService.signup({fullname: 'Puki Norma', username: 'user1', password:'123',score: 100, isAdmin: false})\r\n// userService.signup({fullname: 'Master Adminov', username: 'admin', password:'123', score: 100, isAdmin: true})\r\n// userService.signup({fullname: 'Muki G', username: 'muki', password:'123', score: 100})\r\n\r\nfunction getUsers() {\r\n    return httpService.get(`user`)\r\n}\r\n\r\nasync function signup(userCred) {\r\n    const user = await httpService.post('auth/signup', userCred)\r\n    socketService.emit('set-user-socket', user._id);\r\n    return _saveLocalUser(user)\r\n}\r\n\r\nasync function login(userCred) {\r\n    const user = await httpService.post('auth/login', userCred)\r\n    socketService.emit('login', user._id);\r\n    if (user) return _saveLocalUser(user)\r\n}\r\n\r\nasync function getById(userId) {\r\n    const user = await httpService.get(`user/${userId}`)\r\n    return user;\r\n}\r\nfunction remove(userId) {\r\n    return httpService.delete(`user/${userId}`)\r\n}\r\n\r\nasync function update(user) {\r\n    user = await httpService.put(`user/${user._id}`, user)\r\n    if (getLoggedinUser()._id === user._id) _saveLocalUser(user)\r\n    return user;\r\n}\r\n\r\nasync function logout() {\r\n    sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER)\r\n    socketService.emit('unset-user-socket');\r\n    return await httpService.post('auth/logout')\r\n}\r\n\r\nfunction _saveLocalUser(user) {\r\n    sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER, JSON.stringify(user))\r\n    return user\r\n}\r\n\r\nfunction getLoggedinUser() {\r\n    return JSON.parse(sessionStorage.getItem(STORAGE_KEY_LOGGEDIN_USER) || 'null')\r\n}\r\n\r\n(async () => {\r\n    var user = getLoggedinUser()\r\n   \r\n    window.addEventListener('storage', async () => {\r\n        if (!gWatchedUser) return;\r\n        const freshUsers = await storageService.query('user')\r\n        const watchedUser = freshUsers.find(u => u._id === gWatchedUser._id)\r\n        if (!watchedUser) return;\r\n        if (gWatchedUser.score !== watchedUser.score) {\r\n            console.log('Watched user score changed - localStorage updated from another browser')\r\n            socketService.emit(SOCKET_EVENT_USER_UPDATED, watchedUser)\r\n        }\r\n        gWatchedUser = watchedUser\r\n    })\r\n})();\r\n\r\n\r\n//socketService:\r\n\r\n(async () => {\r\n    var user = getLoggedinUser()\r\n    if (user) socketService.emit('set-user-socket', user._id)\r\n})();"]}]}