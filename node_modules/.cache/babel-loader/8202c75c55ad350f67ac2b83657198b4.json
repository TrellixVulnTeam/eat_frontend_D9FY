{"remainingRequest":"C:\\Users\\shilo\\OneDrive\\שולחן העבודה\\eatWith\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\shilo\\OneDrive\\שולחן העבודה\\eatWith\\frontend\\src\\services\\NEW-user-service.js","dependencies":[{"path":"C:\\Users\\shilo\\OneDrive\\שולחן העבודה\\eatWith\\frontend\\src\\services\\NEW-user-service.js","mtime":1626675359565},{"path":"C:\\Users\\shilo\\OneDrive\\שולחן העבודה\\eatWith\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1626765022900},{"path":"C:\\Users\\shilo\\OneDrive\\שולחן העבודה\\eatWith\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1626765019750}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8gaW1wb3J0IHsgc3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuL2FzeW5jLXN0b3JhZ2Uuc2VydmljZScKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICcuL2h0dHAuc2VydmljZSc7IC8vIGltcG9ydCB7IHNvY2tldFNlcnZpY2UsIFNPQ0tFVF9FVkVOVF9VU0VSX1VQREFURUQgfSBmcm9tICcuL3NvY2tldC5zZXJ2aWNlJwoKY29uc3QgU1RPUkFHRV9LRVlfTE9HR0VESU5fVVNFUiA9ICdsb2dnZWRpblVzZXInOyAvLyBjb25zdCBTQ09SRV9GT1JfUkVWSUVXID0gMTAKLy8gdmFyIGdXYXRjaGVkVXNlciA9IG51bGw7CgpleHBvcnQgY29uc3QgTkVXdXNlclNlcnZpY2UgPSB7CiAgbG9naW4sCiAgbG9nb3V0LAogIHNpZ251cCwKICBnZXRVc2VycywKICBnZXRCeUlkLAogIHJlbW92ZSwKICB1cGRhdGUsCiAgZ2V0TG9nZ2VkaW5Vc2VyCn07IC8vIHdpbmRvdy51c2VyU2VydmljZSA9IHVzZXJTZXJ2aWNlCi8vIE5vdGU6IGR1ZSB0byBhc3luYywgbXVzdCBydW4gb25lIGJ5IG9uZS4uLgovLyB1c2VyU2VydmljZS5zaWdudXAoe2Z1bGxuYW1lOiAnUHVraSBOb3JtYScsIHVzZXJuYW1lOiAndXNlcjEnLCBwYXNzd29yZDonMTIzJyxzY29yZTogMTAwLCBpc0FkbWluOiBmYWxzZX0pCi8vIHVzZXJTZXJ2aWNlLnNpZ251cCh7ZnVsbG5hbWU6ICdNYXN0ZXIgQWRtaW5vdicsIHVzZXJuYW1lOiAnYWRtaW4nLCBwYXNzd29yZDonMTIzJywgc2NvcmU6IDEwMCwgaXNBZG1pbjogdHJ1ZX0pCi8vIHVzZXJTZXJ2aWNlLnNpZ251cCh7ZnVsbG5hbWU6ICdNdWtpIEcnLCB1c2VybmFtZTogJ211a2knLCBwYXNzd29yZDonMTIzJywgc2NvcmU6IDEwMH0pCgpmdW5jdGlvbiBnZXRVc2VycygpIHsKICAvLyByZXR1cm4gc3RvcmFnZVNlcnZpY2UucXVlcnkoJ3VzZXInKQogIHJldHVybiBodHRwU2VydmljZS5nZXQoYHVzZXJgKTsKfQoKYXN5bmMgZnVuY3Rpb24gc2lnbnVwKHVzZXJDcmVkKSB7CiAgLy8gdXNlckNyZWQuc2NvcmUgPSAxMDA7CiAgLy8gY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2VTZXJ2aWNlLnBvc3QoJ3VzZXInLCB1c2VyQ3JlZCkKICBjb25zdCB1c2VyID0gYXdhaXQgaHR0cFNlcnZpY2UucG9zdCgnYXV0aC9zaWdudXAnLCB1c2VyQ3JlZCk7IC8vIHNvY2tldFNlcnZpY2UuZW1pdCgnc2V0LXVzZXItc29ja2V0JywgdXNlci5faWQpOwoKICByZXR1cm4gX3NhdmVMb2NhbFVzZXIodXNlcik7Cn0KCmFzeW5jIGZ1bmN0aW9uIGxvZ2luKHVzZXJDcmVkKSB7CiAgLy8gY29uc3QgdXNlcnMgPSBhd2FpdCBzdG9yYWdlU2VydmljZS5xdWVyeSgndXNlcicpCiAgLy8gY29uc3QgdXNlciA9IHVzZXJzLmZpbmQodXNlciA9PiB1c2VyLnVzZXJuYW1lID09PSB1c2VyQ3JlZC51c2VybmFtZSkKICAvLyByZXR1cm4gX3NhdmVMb2NhbFVzZXIodXNlcikKICBjb25zdCB1c2VyID0gYXdhaXQgaHR0cFNlcnZpY2UucG9zdCgnYXV0aC9sb2dpbicsIHVzZXJDcmVkKTsgLy8gc29ja2V0U2VydmljZS5lbWl0KCdsb2dpbicsIHVzZXIuX2lkKTsKCiAgaWYgKHVzZXIpIHJldHVybiBfc2F2ZUxvY2FsVXNlcih1c2VyKTsKfQoKYXN5bmMgZnVuY3Rpb24gZ2V0QnlJZCh1c2VySWQpIHsKICAvLyBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZVNlcnZpY2UuZ2V0KCd1c2VyJywgdXNlcklkKQogIGNvbnN0IHVzZXIgPSBhd2FpdCBodHRwU2VydmljZS5nZXQoYHVzZXIvJHt1c2VySWR9YCk7IC8vIGdXYXRjaGVkVXNlciA9IHVzZXI7CgogIHJldHVybiB1c2VyOwp9CgpmdW5jdGlvbiByZW1vdmUodXNlcklkKSB7CiAgLy8gcmV0dXJuIHN0b3JhZ2VTZXJ2aWNlLnJlbW92ZSgndXNlcicsIHVzZXJJZCkKICByZXR1cm4gaHR0cFNlcnZpY2UuZGVsZXRlKGB1c2VyLyR7dXNlcklkfWApOwp9Cgphc3luYyBmdW5jdGlvbiB1cGRhdGUodXNlcikgewogIC8vIGF3YWl0IHN0b3JhZ2VTZXJ2aWNlLnB1dCgndXNlcicsIHVzZXIpCiAgdXNlciA9IGF3YWl0IGh0dHBTZXJ2aWNlLnB1dChgdXNlci8ke3VzZXIuX2lkfWAsIHVzZXIpOyAvLyBIYW5kbGUgY2FzZSBpbiB3aGljaCBhZG1pbiB1cGRhdGVzIG90aGVyIHVzZXIncyBkZXRhaWxzCgogIGlmIChnZXRMb2dnZWRpblVzZXIoKS5faWQgPT09IHVzZXIuX2lkKSBfc2F2ZUxvY2FsVXNlcih1c2VyKTsKICByZXR1cm4gdXNlcjsKfQoKYXN5bmMgZnVuY3Rpb24gbG9nb3V0KCkgewogIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9LRVlfTE9HR0VESU5fVVNFUik7IC8vIHNvY2tldFNlcnZpY2UuZW1pdCgndW5zZXQtdXNlci1zb2NrZXQnKTsKCiAgcmV0dXJuIGF3YWl0IGh0dHBTZXJ2aWNlLnBvc3QoJ2F1dGgvbG9nb3V0Jyk7Cn0KCmZ1bmN0aW9uIF9zYXZlTG9jYWxVc2VyKHVzZXIpIHsKICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZX0xPR0dFRElOX1VTRVIsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTsKICByZXR1cm4gdXNlcjsKfQoKZnVuY3Rpb24gZ2V0TG9nZ2VkaW5Vc2VyKCkgewogIHJldHVybiBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVlfTE9HR0VESU5fVVNFUikgfHwgJ251bGwnKTsKfSAvLyBUaGlzIElJRkUgZnVuY3Rpb25zIGZvciBEZXYgcHVycG9zZXMgCi8vIEl0IGFsbG93cyB0ZXN0aW5nIG9mIHJlYWwgdGltZSB1cGRhdGVzIChzdWNoIGFzIHNvY2tldHMpIGJ5IGxpc3RlbmluZyB0byBzdG9yYWdlIGV2ZW50cwoKCihhc3luYyAoKSA9PiB7CiAgdmFyIHVzZXIgPSBnZXRMb2dnZWRpblVzZXIoKTsgLy8gRGV2IEhlbHBlcjogTGlzdGVucyB0byB3aGVuIGxvY2FsU3RvcmFnZSBjaGFuZ2VzIGluIE9USEVSIGJyb3dzZXIKICAvLyBIZXJlIHdlIGFyZSBsaXN0ZW5pbmcgdG8gY2hhbmdlcyBmb3IgdGhlIHdhdGNoZWQgdXNlciAoY29tbWluZyBmcm9tIG90aGVyIGJyb3dzZXJzKQoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc3RvcmFnZScsIGFzeW5jICgpID0+IHsKICAgIGlmICghZ1dhdGNoZWRVc2VyKSByZXR1cm47CiAgICBjb25zdCBmcmVzaFVzZXJzID0gYXdhaXQgc3RvcmFnZVNlcnZpY2UucXVlcnkoJ3VzZXInKTsKICAgIGNvbnN0IHdhdGNoZWRVc2VyID0gZnJlc2hVc2Vycy5maW5kKHUgPT4gdS5faWQgPT09IGdXYXRjaGVkVXNlci5faWQpOwogICAgaWYgKCF3YXRjaGVkVXNlcikgcmV0dXJuOwoKICAgIGlmIChnV2F0Y2hlZFVzZXIuc2NvcmUgIT09IHdhdGNoZWRVc2VyLnNjb3JlKSB7CiAgICAgIGNvbnNvbGUubG9nKCdXYXRjaGVkIHVzZXIgc2NvcmUgY2hhbmdlZCAtIGxvY2FsU3RvcmFnZSB1cGRhdGVkIGZyb20gYW5vdGhlciBicm93c2VyJyk7CiAgICAgIHNvY2tldFNlcnZpY2UuZW1pdChTT0NLRVRfRVZFTlRfVVNFUl9VUERBVEVELCB3YXRjaGVkVXNlcik7CiAgICB9CgogICAgZ1dhdGNoZWRVc2VyID0gd2F0Y2hlZFVzZXI7CiAgfSk7Cn0pKCk7IC8vIFRoaXMgaXMgcmVsZXZhbnQgd2hlbiBiYWNrZW5kIGlzIGNvbm5lY3RlZAovL3NvY2tldFNlcnZpY2U6Ci8vIChhc3luYyAoKSA9PiB7Ci8vICAgICB2YXIgdXNlciA9IGdldExvZ2dlZGluVXNlcigpCi8vICAgICBpZiAodXNlcikgc29ja2V0U2VydmljZS5lbWl0KCdzZXQtdXNlci1zb2NrZXQnLCB1c2VyLl9pZCkKLy8gfSkoKTs="},{"version":3,"sources":["C:/Users/shilo/OneDrive/שולחן העבודה/eatWith/frontend/src/services/NEW-user-service.js"],"names":["httpService","STORAGE_KEY_LOGGEDIN_USER","NEWuserService","login","logout","signup","getUsers","getById","remove","update","getLoggedinUser","get","userCred","user","post","_saveLocalUser","userId","delete","put","_id","sessionStorage","removeItem","setItem","JSON","stringify","parse","getItem","window","addEventListener","gWatchedUser","freshUsers","storageService","query","watchedUser","find","u","score","console","log","socketService","emit","SOCKET_EVENT_USER_UPDATED"],"mappings":"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","sourcesContent":["// import { storageService } from './async-storage.service'\r\nimport { httpService } from './http.service'\r\n// import { socketService, SOCKET_EVENT_USER_UPDATED } from './socket.service'\r\nconst STORAGE_KEY_LOGGEDIN_USER = 'loggedinUser'\r\n// const SCORE_FOR_REVIEW = 10\r\n// var gWatchedUser = null;\r\n\r\nexport const NEWuserService = {\r\n    login,\r\n    logout,\r\n    signup,\r\n    getUsers,\r\n    getById,\r\n    remove,\r\n    update,\r\n    getLoggedinUser\r\n}\r\n\r\n// window.userService = userService\r\n\r\n// Note: due to async, must run one by one...\r\n// userService.signup({fullname: 'Puki Norma', username: 'user1', password:'123',score: 100, isAdmin: false})\r\n// userService.signup({fullname: 'Master Adminov', username: 'admin', password:'123', score: 100, isAdmin: true})\r\n// userService.signup({fullname: 'Muki G', username: 'muki', password:'123', score: 100})\r\n\r\nfunction getUsers() {\r\n    // return storageService.query('user')\r\n    return httpService.get(`user`)\r\n}\r\n\r\nasync function signup(userCred) {\r\n    // userCred.score = 100;\r\n    // const user = await storageService.post('user', userCred)\r\n    const user = await httpService.post('auth/signup', userCred)\r\n    // socketService.emit('set-user-socket', user._id);\r\n    return _saveLocalUser(user)\r\n}\r\n\r\nasync function login(userCred) {\r\n    // const users = await storageService.query('user')\r\n    // const user = users.find(user => user.username === userCred.username)\r\n    // return _saveLocalUser(user)\r\n\r\n    const user = await httpService.post('auth/login', userCred)\r\n    // socketService.emit('login', user._id);\r\n    if (user) return _saveLocalUser(user)\r\n}\r\n\r\nasync function getById(userId) {\r\n    // const user = await storageService.get('user', userId)\r\n    const user = await httpService.get(`user/${userId}`)\r\n    // gWatchedUser = user;\r\n    return user;\r\n}\r\nfunction remove(userId) {\r\n    // return storageService.remove('user', userId)\r\n    return httpService.delete(`user/${userId}`)\r\n}\r\n\r\nasync function update(user) {\r\n    // await storageService.put('user', user)\r\n    user = await httpService.put(`user/${user._id}`, user)\r\n    // Handle case in which admin updates other user's details\r\n    if (getLoggedinUser()._id === user._id) _saveLocalUser(user)\r\n    return user;\r\n}\r\n\r\nasync function logout() {\r\n    sessionStorage.removeItem(STORAGE_KEY_LOGGEDIN_USER)\r\n    // socketService.emit('unset-user-socket');\r\n    return await httpService.post('auth/logout')\r\n}\r\n\r\nfunction _saveLocalUser(user) {\r\n    sessionStorage.setItem(STORAGE_KEY_LOGGEDIN_USER, JSON.stringify(user))\r\n    return user\r\n}\r\n\r\nfunction getLoggedinUser() {\r\n    return JSON.parse(sessionStorage.getItem(STORAGE_KEY_LOGGEDIN_USER) || 'null')\r\n}\r\n\r\n// This IIFE functions for Dev purposes \r\n// It allows testing of real time updates (such as sockets) by listening to storage events\r\n(async () => {\r\n    var user = getLoggedinUser()\r\n    // Dev Helper: Listens to when localStorage changes in OTHER browser\r\n\r\n    // Here we are listening to changes for the watched user (comming from other browsers)\r\n    window.addEventListener('storage', async () => {\r\n        if (!gWatchedUser) return;\r\n        const freshUsers = await storageService.query('user')\r\n        const watchedUser = freshUsers.find(u => u._id === gWatchedUser._id)\r\n        if (!watchedUser) return;\r\n        if (gWatchedUser.score !== watchedUser.score) {\r\n            console.log('Watched user score changed - localStorage updated from another browser')\r\n            socketService.emit(SOCKET_EVENT_USER_UPDATED, watchedUser)\r\n        }\r\n        gWatchedUser = watchedUser\r\n    })\r\n})();\r\n\r\n// This is relevant when backend is connected\r\n\r\n\r\n//socketService:\r\n\r\n// (async () => {\r\n//     var user = getLoggedinUser()\r\n//     if (user) socketService.emit('set-user-socket', user._id)\r\n// })();"]}]}